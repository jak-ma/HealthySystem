!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/g-lite")):"function"==typeof define&&define.amd?define(["exports","@antv/g-lite"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).G=t.G||{},t.G.Gesture={}),t.window.G)}(this,(function(t,e){"use strict";var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)};var r=function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)};var i="object"==typeof performance&&performance.now?performance:Date,o=function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.abs(n)>Math.abs(r)?n>0?"right":"left":r>0?"down":"up"},s=function(t,e){var n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return Math.sqrt(n*n+r*r)},a=function(){function t(t){var e=this;this.options=t,this.evCache=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this._start=function(t,n){var r;e.reset(),e.startTime=i.now();var o=e.evCache,a=e.startPoints;if(t){var p=t.pointerId,c=t.x,v=t.y,u=o.findIndex((function(t){return p===t.pointerId}));-1!==u&&o.splice(u,1),o.push({pointerId:p,x:c,y:v,ev:t});for(var l=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;o>i;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}([],function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}((null===(r=t.nativeEvent)||void 0===r?void 0:r.touches)||[]),!1),h=function(t){if(l.find((function(e){return o[t].pointerId===e.identifier})))return"continue";o.splice(t,1)},f=o.length-1;f>-1;f--)h(f)}a.length=o.length;for(f=0;o.length>f;f++){var d=o[f];a[f]={x:c=d.x,y:v=d.y}}if(1!==a.length){var y,m;e.startDistance=s(a[0],a[1]),e.center={x:(y=a[0]).x+((m=a[1]).x-y.x)/2,y:y.y+(m.y-y.y)/2}}else{var g=o[0].ev;e.pressTimeout=setTimeout((function(){var t="press",r="none";g.direction=r,g.deltaX=0,g.deltaY=0,g.points=a,e.emitStart(t,g,n),g.type=t,n.dispatchEvent(g),e.eventType=t,e.direction=r,e.movingTarget=n}),250)}},this._move=function(t,n){e.clearPressTimeout();var r=e.startPoints,a=e.evCache;if(r.length){for(var p=t.x,c=t.y,v=t.pointerId,u=0,l=a.length;l>u;u++)if(v===a[u].pointerId){a[u]={pointerId:v,x:p,y:c,ev:t};break}var h={x:p,y:c},f=a.map((function(t){return{x:t.x,y:t.y}})),d=i.now();if(e.prevMoveTime=e.lastMoveTime,e.prevMovePoint=e.lastMovePoint,e.lastMoveTime=d,e.lastMovePoint=h,1===r.length){var y=r[0],m=p-y.x,g=c-y.y,T=e.direction||o(y,h);e.direction=T;var E=e.getEventType(h,n,t);return t.direction=T,t.deltaX=m,t.deltaY=g,t.points=f,e.emitStart(E,t,n),t.type=E,void e.refreshAndGetTarget(n).dispatchEvent(t)}var P=e.startDistance,x=s(f[0],f[1]);t.zoom=x/P,t.center=e.center,t.points=f,e.emitStart("pinch",t,n),e._throttleEmit("pinch",t,n)}},this._end=function(t,n){var r=e.evCache,a=e.startPoints,p=r.map((function(t){return{x:t.x,y:t.y}}));if(t.points=p,e.emitEnd(t,e.refreshAndGetTarget(n)),1===r.length){var c=i.now(),v=e.lastMoveTime;if(100>c-v){var u=v-(e.prevMoveTime||e.startTime);if(u>0){var l=e.prevMovePoint||a[0],h=e.lastMovePoint||a[0],f=s(l,h)/u;f>.3&&(t.velocity=f,t.direction=o(l,h),t.type="swipe",n.dispatchEvent(t))}}}for(var d=0,y=r.length;y>d;d++)if(r[d].pointerId===t.pointerId){r.splice(d,1),a.splice(d,1);break}e.reset(),r.length>0&&e._start(void 0,n)},this._cancel=function(t,n){var r=e.evCache.map((function(t){return{x:t.x,y:t.y}}));t.points=r,e.emitEnd(t,e.refreshAndGetTarget(n)),e.evCache=[],e.reset()}}return t.prototype.apply=function(e){var n=this,r=e.renderingService,i=e.renderingContext.root.ownerDocument,o=i.defaultView;this.canvas=o;var s=function(t){return t===i&&n.options.isDocumentGestureEnabled?i:t},a=function(t){var e=s(t.target);e&&n._move(t,e)},p=function(t){var e=s(t.target);e&&n._start(t,e)},c=function(t){var e=s(t.target);e&&n._end(t,e)},v=function(t){var e=s(t.target);e&&n._cancel(t,e)},u=function(t){var e=s(t.target);e&&n._end(t,e)};r.hooks.init.tap(t.tag,(function(){o.addEventListener("pointermove",a),o.addEventListener("pointerdown",p),o.addEventListener("pointerup",c),o.addEventListener("pointercancel",v),o.addEventListener("pointerupoutside",u)})),r.hooks.destroy.tap(t.tag,(function(){o.removeEventListener("pointermove",a),o.removeEventListener("pointerdown",p),o.removeEventListener("pointerup",c),o.removeEventListener("pointercancel",v),o.removeEventListener("pointerupoutside",u)}))},t.prototype.getEventType=function(t,e,n){var r,o=this,a=o.eventType,p=o.startTime,c=o.startPoints;if(a)return a;(this.movingTarget=e,this.isPanListenerInPath=n.path.some((function(t){var e,n;return!!(null===(n=null===(e=t.emitter)||void 0===e?void 0:e.eventNames())||void 0===n?void 0:n.includes("pan"))})),this.isPanListenerInPath)?r=i.now()-p>250&&10>s(c[0],t)?"press":"pan":r="press";return this.eventType=r,r},t.prototype.enable=function(t){this.processEvent[t]=!0},t.prototype.isProcess=function(t){return this.processEvent[t]},t.prototype.emitStart=function(t,e,n){this.isProcess(t)||(this.enable(t),e.type="".concat(t,"start"),n.dispatchEvent(e))},t.prototype._throttleEmit=function(t,e,n){var r=this;this.pushEvent(t,e);var i=this,o=i.emitThrottles,s=i.processEvent;i.throttleTimer||(this.throttleTimer=this.canvas.requestAnimationFrame((function(){for(var t=0,e=o.length;e>t;t++){var i=o[t],a=i.type,p=i.ev;s[a]&&(p.type=a,n.dispatchEvent(p))}r.throttleTimer=0,r.emitThrottles.length=0})))},t.prototype.emitEnd=function(t,e){var n=this.processEvent;Object.keys(n).forEach((function(r){t.type="".concat(r,"end"),e.dispatchEvent(t),delete n[r]}))},t.prototype.pushEvent=function(t,e){for(var n=this.emitThrottles,r={type:t,ev:e},i=0,o=n.length;o>i;i++)if(n[i].type===t)return void n.splice(i,1,r);n.push(r)},t.prototype.clearPressTimeout=function(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)},t.prototype.refreshAndGetTarget=function(t){return this.movingTarget?(this.movingTarget&&!this.movingTarget.isConnected&&(this.movingTarget=t),this.movingTarget):t},t.prototype.reset=function(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null,this.movingTarget=null,this.isPanListenerInPath=null},t.tag="Gesture",t}(),p=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="gesture",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+e+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.init=function(){this.addRenderingPlugin(new a(r({isDocumentGestureEnabled:!1},this.options)))},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(e.AbstractRendererPlugin);t.Plugin=p}));
//# sourceMappingURL=index.umd.min.js.map
