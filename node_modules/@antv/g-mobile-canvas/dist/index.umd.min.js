!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/g-lite")):"function"==typeof define&&define.amd?define(["exports","@antv/g-lite"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).G=t.G||{},t.G.MobileCanvas2D={}),t.window.G)}(this,(function(t,e){"use strict";var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)};function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+e+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var i=function(){return i=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i.apply(this,arguments)};function a(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}c((r=r.apply(t,e||[])).next())}))}function o(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&i[3]>s[1])){o.label=s[1];break}if(6===s[0]&&i[1]>o.label){o.label=i[1],i=s;break}if(i&&i[2]>o.label){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function s(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,a=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function c(t,e,n){if(n||2===arguments.length)for(var r,i=0,a=e.length;a>i;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}var l="undefined"!=typeof Float32Array?Float32Array:Array;function h(){var t=new l(16);return l!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function p(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],h=e[7],u=e[8],p=e[9],d=e[10],f=e[11],v=e[12],g=e[13],y=e[14],m=e[15],x=n[0],M=n[1],P=n[2],E=n[3];return t[0]=x*r+M*s+P*u+E*v,t[1]=x*i+M*c+P*p+E*g,t[2]=x*a+M*l+P*d+E*y,t[3]=x*o+M*h+P*f+E*m,t[4]=(x=n[4])*r+(M=n[5])*s+(P=n[6])*u+(E=n[7])*v,t[5]=x*i+M*c+P*p+E*g,t[6]=x*a+M*l+P*d+E*y,t[7]=x*o+M*h+P*f+E*m,t[8]=(x=n[8])*r+(M=n[9])*s+(P=n[10])*u+(E=n[11])*v,t[9]=x*i+M*c+P*p+E*g,t[10]=x*a+M*l+P*d+E*y,t[11]=x*o+M*h+P*f+E*m,t[12]=(x=n[12])*r+(M=n[13])*s+(P=n[14])*u+(E=n[15])*v,t[13]=x*i+M*c+P*p+E*g,t[14]=x*a+M*l+P*d+E*y,t[15]=x*o+M*h+P*f+E*m,t}function d(t,e,n){var r,i,a,o,s,c,l,h,u,p,d,f,v=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*v+e[4]*g+e[8]*y+e[12],t[13]=e[1]*v+e[5]*g+e[9]*y+e[13],t[14]=e[2]*v+e[6]*g+e[10]*y+e[14],t[15]=e[3]*v+e[7]*g+e[11]*y+e[15]):(i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],h=e[7],u=e[8],p=e[9],d=e[10],f=e[11],t[0]=r=e[0],t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=c,t[6]=l,t[7]=h,t[8]=u,t[9]=p,t[10]=d,t[11]=f,t[12]=r*v+s*g+u*y+e[12],t[13]=i*v+c*g+p*y+e[13],t[14]=a*v+l*g+d*y+e[14],t[15]=o*v+h*g+f*y+e[15]),t}function f(){var t=new l(3);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function v(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function g(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/(o=o||1),t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}function y(t,e,n){return{x:t*Math.cos(n)-e*Math.sin(n),y:t*Math.sin(n)+e*Math.cos(n)}}function m(t,e,n,r,i,a,o,s,c,l){var h,u,p,d,f,v=t,g=e,x=n,M=r,P=s,E=c,b=120*Math.PI/180,T=Math.PI/180*(+i||0),S=[];if(l)u=l[0],p=l[1],d=l[2],f=l[3];else{g=(h=y(v,g,-T)).y;var w=((v=h.x)-(P=(h=y(P,E,-T)).x))/2,C=(g-(E=h.y))/2,A=w*w/(x*x)+C*C/(M*M);A>1&&(x*=A=Math.sqrt(A),M*=A);var k=x*x,O=M*M,R=(a===o?-1:1)*Math.sqrt(Math.abs((k*O-k*C*C-O*w*w)/(k*C*C+O*w*w)));d=R*x*C/M+(v+P)/2,u=Math.asin(((g-(f=R*-M*w/x+(g+E)/2))/M*1e9>>0)/1e9),p=Math.asin(((E-f)/M*1e9>>0)/1e9),0>(u=d>v?Math.PI-u:u)&&(u=2*Math.PI+u),0>(p=d>P?Math.PI-p:p)&&(p=2*Math.PI+p),o&&u>p&&(u-=2*Math.PI),!o&&p>u&&(p-=2*Math.PI)}var L=p-u;if(Math.abs(L)>b){var D=p,I=P,B=E;S=m(P=d+x*Math.cos(p=u+b*(o&&p>u?1:-1)),E=f+M*Math.sin(p),x,M,i,0,o,I,B,[p,D,d,f])}L=p-u;var N=Math.cos(u),F=Math.sin(u),G=Math.cos(p),j=Math.sin(p),_=Math.tan(L/4),Y=4/3*x*_,X=4/3*M*_,W=[v,g],H=[v+Y*F,g-X*N],U=[P+Y*j,E-X*G],q=[P,E];if(H[0]=2*W[0]-H[0],H[1]=2*W[1]-H[1],l)return H.concat(U,q,S);for(var Q=[],z=0,V=(S=H.concat(U,q,S)).length;V>z;z+=1)Q[z]=z%2?y(S[z-1],S[z],T).y:y(S[z],S[z+1],T).x;return Q}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),f(),function(){var t,e=(t=new l(2),l!=Float32Array&&(t[0]=0,t[1]=0),t)}();var x=function(t){return null==t},M={}.toString,P=function(t,e){return M.call(t)==="[object "+e+"]"},E=function(t){return P(t,"String")},b=function(t,e,n){return e>t?e:t>n?n:t};function T(t,e){var n=e.r;t.arc(n,n,n,0,2*Math.PI,!1)}function S(t,e){var n=e.rx,r=e.ry;if(t.ellipse)t.ellipse(n,r,n,r,0,0,2*Math.PI,!1);else{var i=n>r?n:r,a=n>r?1:n/r,o=n>r?r/n:1;t.save(),t.scale(a,o),t.arc(i,i,i,0,2*Math.PI)}}function w(t,n){var r=n.x1,i=n.y1,a=n.x2,o=n.y2,s=n.defX,c=void 0===s?0:s,l=n.defY,h=void 0===l?0:l,u=n.markerStart,p=n.markerEnd,d=n.markerStartOffset,f=n.markerEndOffset,v=0,g=0,y=0,m=0,x=0;u&&e.isDisplayObject(u)&&d&&(v=Math.cos(x=Math.atan2(o-i,a-r))*(d||0),g=Math.sin(x)*(d||0)),p&&e.isDisplayObject(p)&&f&&(y=Math.cos(x=Math.atan2(i-o,r-a))*(f||0),m=Math.sin(x)*(f||0)),t.moveTo(r-c+v,i-h+g),t.lineTo(a-c+y,o-h+m)}function C(t,n){var r=n.defX,i=void 0===r?0:r,a=n.defY,o=void 0===a?0:a,c=n.markerStart,l=n.markerEnd,h=n.markerStartOffset,u=n.markerEndOffset,p=n.path,d=p.absolutePath,f=p.segments,v=0,g=0,y=0,m=0,x=0;if(c&&e.isDisplayObject(c)&&h){var M=s(c.parentNode.getStartTangent(),2);v=Math.cos(x=Math.atan2((P=M[0])[1]-(E=M[1])[1],P[0]-E[0]))*(h||0),g=Math.sin(x)*(h||0)}if(l&&e.isDisplayObject(l)&&u){var P,E,b=s(l.parentNode.getEndTangent(),2);y=Math.cos(x=Math.atan2((P=b[0])[1]-(E=b[1])[1],P[0]-E[0]))*(u||0),m=Math.sin(x)*(u||0)}for(var T=0;d.length>T;T++){var S=d[T],w=d[T+1],C=0===T&&(0!==v||0!==g),A=(T===d.length-1||w&&("M"===w[0]||"Z"===w[0]))&&0!==y&&0!==m;switch(S[0]){case"M":C?(t.moveTo(S[1]-i+v,S[2]-o+g),t.lineTo(S[1]-i,S[2]-o)):t.moveTo(S[1]-i,S[2]-o);break;case"L":A?t.lineTo(S[1]-i+y,S[2]-o+m):t.lineTo(S[1]-i,S[2]-o);break;case"Q":t.quadraticCurveTo(S[1]-i,S[2]-o,S[3]-i,S[4]-o),A&&t.lineTo(S[3]-i+y,S[4]-o+m);break;case"C":t.bezierCurveTo(S[1]-i,S[2]-o,S[3]-i,S[4]-o,S[5]-i,S[6]-o),A&&t.lineTo(S[5]-i+y,S[6]-o+m);break;case"A":var k=f[T].arcParams,O=k.cx,R=k.cy,L=k.rx,D=k.ry,I=k.startAngle,B=k.endAngle,N=k.xRotation,F=k.sweepFlag;if(t.ellipse)t.ellipse(O-i,R-o,L,D,N,I,B,!!(1-F));else{var G=L>D?L:D,j=L>D?1:L/D,_=L>D?D/L:1;t.translate(O-i,R-o),t.rotate(N),t.scale(j,_),t.arc(0,0,G,I,B,!!(1-F)),t.scale(1/j,1/_),t.rotate(-N),t.translate(-(O-i),-(R-o))}A&&t.lineTo(S[6]-i+y,S[7]-o+m);break;case"Z":t.closePath()}}}function A(t,n){var r=n.defX,i=void 0===r?0:r,a=n.defY,o=void 0===a?0:a,s=n.markerStart,c=n.markerEnd,l=n.markerStartOffset,h=n.markerEndOffset,u=n.points.points,p=u.length,d=u[0][0]-i,f=u[0][1]-o,v=u[p-1][0]-i,g=u[p-1][1]-o,y=0,m=0,x=0,M=0,P=0;s&&e.isDisplayObject(s)&&l&&(y=Math.cos(P=Math.atan2(u[1][1]-u[0][1],u[1][0]-u[0][0]))*(l||0),m=Math.sin(P)*(l||0)),c&&e.isDisplayObject(c)&&h&&(x=Math.cos(P=Math.atan2(u[p-1][1]-u[0][1],u[p-1][0]-u[0][0]))*(h||0),M=Math.sin(P)*(h||0)),t.moveTo(d+(y||x),f+(m||M));for(var E=1;p-1>E;E++){var b=u[E];t.lineTo(b[0]-i,b[1]-o)}t.lineTo(v,g)}function k(t,n){var r=n.defX,i=void 0===r?0:r,a=n.defY,o=void 0===a?0:a,s=n.markerStart,c=n.markerEnd,l=n.markerStartOffset,h=n.markerEndOffset,u=n.points.points,p=u.length,d=u[0][0]-i,f=u[0][1]-o,v=u[p-1][0]-i,g=u[p-1][1]-o,y=0,m=0,x=0,M=0,P=0;s&&e.isDisplayObject(s)&&l&&(y=Math.cos(P=Math.atan2(u[1][1]-u[0][1],u[1][0]-u[0][0]))*(l||0),m=Math.sin(P)*(l||0)),c&&e.isDisplayObject(c)&&h&&(x=Math.cos(P=Math.atan2(u[p-2][1]-u[p-1][1],u[p-2][0]-u[p-1][0]))*(h||0),M=Math.sin(P)*(h||0)),t.moveTo(d+y,f+m);for(var E=1;p-1>E;E++){var b=u[E];t.lineTo(b[0]-i,b[1]-o)}t.lineTo(v+x,g+M)}function O(t,e){var n=e.radius,r=e.width,i=e.height,a=r,o=i;if(n&&n.some((function(t){return 0!==t}))){var c=r>0?1:-1,l=i>0?1:-1,h=c+l===0,u=s(n.map((function(t){return b(t,0,Math.min(Math.abs(a)/2,Math.abs(o)/2))})),4),p=u[0],d=u[1],f=u[2],v=u[3];t.moveTo(c*p,0),t.lineTo(a-c*d,0),0!==d&&t.arc(a-c*d,l*d,d,-l*Math.PI/2,c>0?0:Math.PI,h),t.lineTo(a,o-l*f),0!==f&&t.arc(a-c*f,o-l*f,f,c>0?0:Math.PI,l>0?Math.PI/2:1.5*Math.PI,h),t.lineTo(c*v,o),0!==v&&t.arc(c*v,o-l*v,v,l>0?Math.PI/2:-Math.PI/2,c>0?Math.PI:0,h),t.lineTo(0,l*p),0!==p&&t.arc(c*p,l*p,p,c>0?Math.PI:0,l>0?1.5*Math.PI:Math.PI/2,h)}else t.rect(0,0,a,o)}var R=function(t){function n(){var e=t.apply(this,c([],s(arguments),!1))||this;return e.name="canvas-path-generator",e}return r(n,t),n.prototype.init=function(){var t,n=((t={})[e.Shape.CIRCLE]=T,t[e.Shape.ELLIPSE]=S,t[e.Shape.RECT]=O,t[e.Shape.LINE]=w,t[e.Shape.POLYLINE]=k,t[e.Shape.POLYGON]=A,t[e.Shape.PATH]=C,t[e.Shape.TEXT]=void 0,t[e.Shape.GROUP]=void 0,t[e.Shape.IMAGE]=void 0,t[e.Shape.HTML]=void 0,t[e.Shape.MESH]=void 0,t);this.context.pathGeneratorFactory=n},n.prototype.destroy=function(){delete this.context.pathGeneratorFactory},n}(e.AbstractRendererPlugin);function L(t,e,n,r){var i=t-n,a=e-r;return Math.sqrt(i*i+a*a)}var D=1e-4;function I(t,e,n,r,i,a){var o=-1,l=1/0,h=[n,r],u=20;a&&a>200&&(u=a/10);for(var p=1/u,d=p/10,f=0;u>=f;f++){var v=f*p,g=[i.apply(void 0,c([],s(t.concat([v])),!1)),i.apply(void 0,c([],s(e.concat([v])),!1))];l>(M=L(h[0],h[1],g[0],g[1]))&&(o=v,l=M)}if(0===o)return{x:t[0],y:e[0]};if(1===o){var y=t.length;return{x:t[y-1],y:e[y-1]}}l=1/0;for(f=0;32>f&&D<=d;f++){var m=o-d,x=o+d,M=(g=[i.apply(void 0,c([],s(t.concat([m])),!1)),i.apply(void 0,c([],s(e.concat([m])),!1))],L(h[0],h[1],g[0],g[1]));if(m>=0&&l>M)o=m,l=M;else{var P=[i.apply(void 0,c([],s(t.concat([x])),!1)),i.apply(void 0,c([],s(e.concat([x])),!1))],E=L(h[0],h[1],P[0],P[1]);1>=x&&l>E?(o=x,l=E):d*=.5}}return{x:i.apply(void 0,c([],s(t.concat([o])),!1)),y:i.apply(void 0,c([],s(e.concat([o])),!1))}}function B(t,e,n,r,i,a){var o=[n-t,r-e];if(function(t,e){return t[0]===e[0]&&t[1]===e[1]}(o,[0,0]))return Math.sqrt((i-t)*(i-t)+(a-e)*(a-e));var s=[-o[1],o[0]];return function(t,e){var n=e[0],r=e[1],i=n*n+r*r;i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i}(s,s),Math.abs(function(t,e){return t[0]*e[0]+t[1]*e[1]}([i-t,a-e],s))}function N(t,e,n,r,i){var a=1-i;return a*a*a*t+3*e*i*a*a+3*n*i*i*a+r*i*i*i}function F(t,e,n,r,i,a,o,s,c,l,h){var u=function(t,e,n,r,i,a,o,s,c,l,h){return I([t,n,i,o],[e,r,a,s],c,l,N,h)}(t,e,n,r,i,a,o,s,c,l,h);return L(u.x,u.y,c,l)}function G(t,e,n,r){var i=1-r;return i*i*t+2*r*i*e+r*r*n}function j(t,e,n,r,i,a,o,s){var c=function(t,e,n,r,i,a,o,s){return I([t,n,i],[e,r,a],o,s,G)}(t,e,n,r,i,a,o,s);return L(c.x,c.y,o,s)}var _=f(),Y=f(),X=f(),W=h(),H=function(){function t(){var t=this;this.isHit=function(n,r,i,a){var o,s,c,l,h,u,p,d,f,y,m,x,M,P,E,b,T,S,w,C,A,k,O,R,L,D,I,B,N,F,G,j=t.context.pointInPathPickerFactory[n.nodeName];if(j){var _=(o=W,(G=(w=(c=(s=i)[0])*(d=s[5])-(l=s[1])*(p=s[4]))*(F=(M=s[10])*(S=s[15])-(P=s[11])*(T=s[14]))-(C=c*(f=s[6])-(h=s[2])*p)*(N=(x=s[9])*S-P*(b=s[13]))+(A=c*(y=s[7])-(u=s[3])*p)*(B=x*T-M*b)+(k=l*f-h*d)*(I=(m=s[8])*S-P*(E=s[12]))-(O=l*y-u*d)*(D=m*T-M*E)+(R=h*y-u*f)*(L=m*b-x*E))?(o[0]=(d*F-f*N+y*B)*(G=1/G),o[1]=(h*N-l*F-u*B)*G,o[2]=(b*R-T*O+S*k)*G,o[3]=(M*O-x*R-P*k)*G,o[4]=(f*I-p*F-y*D)*G,o[5]=(c*F-h*I+u*D)*G,o[6]=(T*A-E*R-S*C)*G,o[7]=(m*R-M*A+P*C)*G,o[8]=(p*N-d*I+y*L)*G,o[9]=(l*I-c*N-u*L)*G,o[10]=(E*O-b*A+S*w)*G,o[11]=(x*A-m*O-P*w)*G,o[12]=(d*D-p*B-f*L)*G,o[13]=(c*B-l*D+h*L)*G,o[14]=(b*C-E*k-T*w)*G,o[15]=(m*k-x*C+M*w)*G,o):null),H=g(Y,v(X,r[0],r[1],0),_),U=n.getGeometryBounds().halfExtents,q=n.parsedStyle.anchor;if(H[0]+=(q&&q[0]||0)*U[0]*2,H[1]+=(q&&q[1]||0)*U[1]*2,j(n,new e.Point(H[0],H[1]),a,t.isPointInPath,t.context,t.runtime))return!0}return!1},this.isPointInPath=function(e,n){var r=t.runtime.offscreenCanvasCreator.getOrCreateContext(t.context.config.offscreenCanvas),i=t.context.pathGeneratorFactory[e.nodeName];return i&&(r.beginPath(),i(r,e.parsedStyle),r.closePath()),r.isPointInPath(n.x,n.y)}}return t.prototype.apply=function(e,n){var r,i=this,s=e.renderingService,c=e.renderingContext;this.context=e,this.runtime=n;var l=null===(r=c.root)||void 0===r?void 0:r.ownerDocument;s.hooks.pick.tapPromise(t.tag,(function(t){return a(i,void 0,void 0,(function(){return o(this,(function(e){return[2,this.pick(l,t)]}))}))})),s.hooks.pickSync.tap(t.tag,(function(t){return i.pick(l,t)}))},t.prototype.pick=function(t,n){var r,i,a=n.topmost,o=n.position,s=v(_,o.x,o.y,0),c=t.elementsFromBBox(s[0],s[1],s[0],s[1]),l=[];try{for(var h=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(c),u=h.next();!u.done;u=h.next()){var p=u.value,d=p.getWorldTransform();if(this.isHit(p,s,d,!1)){var f=e.findClosestClipPathTarget(p);if(f){var g=f.parsedStyle.clipPath;if(this.isHit(g,s,g.getWorldTransform(),!0)){if(a)return n.picked=[p],n;l.push(p)}}else{if(a)return n.picked=[p],n;l.push(p)}}}}catch(t){r={error:t}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}return n.picked=l,n},t.tag="CanvasPicker",t}();function U(t,n,r){var i=t.parsedStyle,a=i.r,o=i.fill,c=i.stroke,l=i.pointerEvents,h=((i.lineWidth||0)+(i.increasedLineWidthForHitTesting||0))/2,u=L(a,a,n.x,n.y),p=s(e.isFillOrStrokeAffected(l,o,c),2),d=p[0],f=p[1];return d&&f||r?a+h>=u:d?a>=u:!!f&&(u>=a-h&&a+h>=u)}function q(t,e,n,r){return t/(n*n)+e/(r*r)}function Q(t,n,r){var i=t.parsedStyle,a=i.rx,o=i.ry,c=i.lineWidth,l=i.increasedLineWidthForHitTesting,h=n.x,u=n.y,p=s(e.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke),2),d=p[0],f=p[1],v=((c||0)+(l||0))/2,g=(h-a)*(h-a),y=(u-o)*(u-o);return d&&f||r?1>=q(g,y,a+v,o+v):d?1>=q(g,y,a,o):!!f&&(q(g,y,a-v,o-v)>=1&&1>=q(g,y,a+v,o+v))}function z(t,e,n,r,i,a){return!(t>i||i>t+n||e>a||a>e+r)}function V(t,e,n,r,i,a,o,s){var c=(Math.atan2(s-e,o-t)+2*Math.PI)%(2*Math.PI),l={x:t+n*Math.cos(c),y:e+n*Math.sin(c)};return L(l.x,l.y,o,s)<=a/2}function $(t,e,n,r,i,a,o){var s=i/2;return!(Math.min(t,n)-s>a||a>Math.max(t,n)+s||Math.min(e,r)-s>o||o>Math.max(e,r)+s)&&B(t,e,n,r,a,o)<=i/2}function J(t,e,n,r,i){var a=t.length;if(2>a)return!1;for(var o=0;a-1>o;o++){if($(t[o][0],t[o][1],t[o+1][0],t[o+1][1],e,n,r))return!0}if(i){var s=t[0],c=t[a-1];if($(s[0],s[1],c[0],c[1],e,n,r))return!0}return!1}var K=1e-6;function Z(t){return K>Math.abs(t)?0:0>t?-1:1}function tt(t,e,n){return!((n[0]-t[0])*(e[1]-t[1])!=(e[0]-t[0])*(n[1]-t[1])||Math.min(t[0],e[0])>n[0]||n[0]>Math.max(t[0],e[0])||Math.min(t[1],e[1])>n[1]||n[1]>Math.max(t[1],e[1]))}function et(t,e,n){var r=!1,i=t.length;if(2>=i)return!1;for(var a=0;i>a;a++){var o=t[a],s=t[(a+1)%i];if(tt(o,s,[e,n]))return!0;Z(o[1]-n)>0!=Z(s[1]-n)>0&&0>Z(e-(n-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])&&(r=!r)}return r}function nt(t,e,n){for(var r=!1,i=0;t.length>i;i++){if(r=et(t[i],e,n))break}return r}function rt(t,n,r){var i=t.parsedStyle,a=i.x1,o=i.y1,c=i.x2,l=i.y2,h=i.lineWidth,u=i.increasedLineWidthForHitTesting,p=i.defX,d=void 0===p?0:p,f=i.defY,v=void 0===f?0:f;return!(!s(e.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke),2)[1]&&!r||!h)&&$(a,o,c,l,(h||0)+(u||0),n.x+d,n.y+v)}function it(t,n,r,i,a,o){var c=t.parsedStyle,l=c.lineWidth,h=c.increasedLineWidthForHitTesting,u=c.defX,p=void 0===u?0:u,d=c.defY,f=void 0===d?0:d,v=c.path,g=v.segments,y=v.hasArc,x=v.polylines,M=v.polygons,P=s(e.isFillOrStrokeAffected(c.pointerEvents,(null==M?void 0:M.length)&&c.fill,c.stroke),2),E=P[0],b=P[1],T=e.getOrCalculatePathTotalLength(t),S=!1;return E||r?S=y?i(t,n):nt(M,n.x+p,n.y+f)||nt(x,n.x+p,n.y+f):((b||r)&&(S=function(t,e,n,r,i){for(var a=!1,o=e/2,s=0;t.length>s;s++){var c=t[s],l=c.currentPoint,h=c.params,u=c.prePoint,p=c.box;if(!p||z(p.x-o,p.y-o,p.width+e,p.height+e,n,r))switch(c.command){case"L":case"Z":if(a=$(u[0],u[1],l[0],l[1],e,n,r))return!0;break;case"Q":if(a=e/2>=j(u[0],u[1],h[1],h[2],h[3],h[4],n,r))return!0;break;case"C":if(a=e/2>=F(u[0],u[1],h[1],h[2],h[3],h[4],h[5],h[6],n,r,i))return!0;break;case"A":c.cubicParams||(c.cubicParams=m(u[0],u[1],h[1],h[2],h[3],h[4],h[5],h[6],h[7],void 0));for(var d=c.cubicParams,f=u,v=0;d.length>v;v+=6){var g=F(f[0],f[1],d[v],d[v+1],d[v+2],d[v+3],d[v+4],d[v+5],n,r,i);if(f=[d[v+4],d[v+5]],a=e/2>=g)return!0}}}return a}(g,(l||0)+(h||0),n.x+p,n.y+f,T)),S)}function at(t,n,r){var i=t.parsedStyle,a=i.lineWidth,o=i.increasedLineWidthForHitTesting,c=i.points,l=i.defX,h=void 0===l?0:l,u=i.defY,p=void 0===u?0:u,d=s(e.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke),2),f=d[0],v=!1;return(d[1]||r)&&(v=J(c.points,(a||0)+(o||0),n.x+h,n.y+p,!0)),v||!f&&!r||(v=et(c.points,n.x+h,n.y+p)),v}function ot(t,n,r){var i=t.parsedStyle,a=i.lineWidth,o=i.increasedLineWidthForHitTesting,c=i.points,l=i.defX,h=void 0===l?0:l,u=i.defY,p=void 0===u?0:u;return!(!s(e.isFillOrStrokeAffected(i.pointerEvents,i.fill,i.stroke),2)[1]&&!r||!a)&&J(c.points,(a||0)+(o||0),n.x+h,n.y+p,!1)}function st(t,n,r,i,a){var o=t.parsedStyle,c=o.radius,l=o.lineWidth,h=o.increasedLineWidthForHitTesting,u=o.width,p=o.height,d=s(e.isFillOrStrokeAffected(o.pointerEvents,o.fill,o.stroke),2),f=d[0],v=d[1],g=(l||0)+(h||0);if(c&&c.some((function(t){return 0!==t}))){var y=!1;return(v||r)&&(y=function(t,e,n,r,i,a,o,c){var l=s(i,4),h=l[0],u=l[1],p=l[2],d=l[3];return $(t+h,e,t+n-u,e,a,o,c)||$(t+n,e+u,t+n,e+r-p,a,o,c)||$(t+n-p,e+r,t+d,e+r,a,o,c)||$(t,e+r-d,t,e+h,a,o,c)||V(t+n-u,e+u,u,0,0,a,o,c)||V(t+n-p,e+r-p,p,0,0,a,o,c)||V(t+d,e+r-d,d,0,0,a,o,c)||V(t+h,e+h,h,0,0,a,o,c)}(0,0,u,p,c.map((function(t){return b(t,0,Math.min(Math.abs(u)/2,Math.abs(p)/2))})),g,n.x,n.y)),y||!f&&!r||(y=i(t,n)),y}var m=g/2;return f&&v||r?z(0-m,0-m,u+m,p+m,n.x,n.y):f?z(0,0,u,p,n.x,n.y):!!v&&function(t,e,n,r,i,a,o){var s=i/2;return z(t-s,e-s,n,i,a,o)||z(t+n-s,e-s,i,r,a,o)||z(t+s,e+r-s,n,i,a,o)||z(t-s,e+s,i,r,a,o)}(0,0,u,p,g,n.x,n.y)}function ct(t,n,r,i,a,o){var s=t.parsedStyle,c=s.width,l=s.height;if("non-transparent-pixel"===s.pointerEvents){var h=a.config.offscreenCanvas,u=o.offscreenCanvasCreator.getOrCreateCanvas(h),p=o.offscreenCanvasCreator.getOrCreateContext(h,{willReadFrequently:!0});return u.width=c,u.height=l,a.defaultStyleRendererFactory[e.Shape.IMAGE].render(p,t.parsedStyle,t,void 0,void 0,void 0),p.getImageData(n.x,n.y,1,1).data.every((function(t){return 0!==t}))}return!0}var lt=function(t){function n(){var e=t.apply(this,c([],s(arguments),!1))||this;return e.name="canvas-picker",e}return r(n,t),n.prototype.init=function(){var t,n=((t={})[e.Shape.CIRCLE]=U,t[e.Shape.ELLIPSE]=Q,t[e.Shape.RECT]=st,t[e.Shape.LINE]=rt,t[e.Shape.POLYLINE]=ot,t[e.Shape.POLYGON]=at,t[e.Shape.PATH]=it,t[e.Shape.TEXT]=function(){return!0},t[e.Shape.GROUP]=null,t[e.Shape.IMAGE]=ct,t[e.Shape.HTML]=null,t[e.Shape.MESH]=null,t);this.context.pointInPathPickerFactory=n,this.addRenderingPlugin(new H)},n.prototype.destroy=function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()},n}(e.AbstractRendererPlugin),ht=Object.freeze({__proto__:null,Plugin:lt}),ut=function(){function t(t){this.canvasRendererPluginOptions=t,this.removedRBushNodeAABBs=[],this.renderQueue=[],this.restoreStack=[],this.clearFullScreen=!1,this.vpMatrix=h(),this.dprMatrix=h(),this.tmpMat4=h(),this.vec3a=f(),this.vec3b=f(),this.vec3c=f(),this.vec3d=f()}return t.prototype.apply=function(n,r){var i=this;this.context=n;var a=n.config,o=n.camera,l=n.renderingService,h=n.renderingContext,u=n.pathGeneratorFactory;this.rBush=n.rBushRoot,this.pathGeneratorFactory=u;var d=n.contextService,f=h.root.ownerDocument.defaultView,v=function(t){var e=t.target.rBushNode;e.aabb&&i.removedRBushNodeAABBs.push(e.aabb)},y=function(t){var e=t.target.rBushNode;e.aabb&&i.removedRBushNodeAABBs.push(e.aabb)};l.hooks.init.tap(t.tag,(function(){f.addEventListener(e.ElementEvent.UNMOUNTED,v),f.addEventListener(e.ElementEvent.CULLED,y);var t=d.getDPR(),n=a.width,r=a.height,o=d.getContext();i.clearRect(o,0,0,n*t,r*t,a.background)})),l.hooks.destroy.tap(t.tag,(function(){f.removeEventListener(e.ElementEvent.UNMOUNTED,v),f.removeEventListener(e.ElementEvent.CULLED,y),i.renderQueue=[],i.removedRBushNodeAABBs=[],i.restoreStack=[]})),l.hooks.beginFrame.tap(t.tag,(function(){var t=d.getContext(),e=d.getDPR(),n=a.width,r=a.height,o=i.canvasRendererPluginOptions,s=o.dirtyObjectNumThreshold,c=o.dirtyObjectRatioThreshold,h=l.getStats(),u=h.rendered,p=u/h.total;i.clearFullScreen=l.disableDirtyRectangleRendering()||u>s&&p>c,t&&(t.resetTransform?t.resetTransform():t.setTransform(1,0,0,1,0,0),i.clearFullScreen&&i.clearRect(t,0,0,n*e,r*e,a.background))}));var m=function(t,e){t.isVisible()&&!t.isCulled()&&(i.renderDisplayObject(t,e,i.context,i.restoreStack,r),i.saveDirtyAABB(t)),(t.sortable.sorted||t.childNodes).forEach((function(t){m(t,e)}))};l.hooks.endFrame.tap(t.tag,(function(){var t,n,l=d.getContext(),u=d.getDPR();if((t=i.dprMatrix)[0]=(n=[u,u,1])[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,p(i.vpMatrix,i.dprMatrix,o.getOrthoMatrix()),i.clearFullScreen)m(h.root,l);else{var v=i.safeMergeAABB.apply(i,c([i.mergeDirtyAABBs(i.renderQueue)],s(i.removedRBushNodeAABBs.map((function(t){var n=t.minX,r=t.minY,i=t.maxX,a=t.maxY,o=new e.AABB;return o.setMinMax([n,r,0],[i,a,0]),o}))),!1));if(i.removedRBushNodeAABBs=[],e.AABB.isEmpty(v))return void(i.renderQueue=[]);var y=i.convertAABB2Rect(v),x=y.x,M=y.y,P=y.width,E=y.height,b=g(i.vec3a,[x,M,0],i.vpMatrix),T=g(i.vec3b,[x+P,M,0],i.vpMatrix),S=g(i.vec3c,[x,M+E,0],i.vpMatrix),w=g(i.vec3d,[x+P,M+E,0],i.vpMatrix),C=Math.min(b[0],T[0],w[0],S[0]),A=Math.min(b[1],T[1],w[1],S[1]),k=Math.max(b[0],T[0],w[0],S[0]),O=Math.max(b[1],T[1],w[1],S[1]),R=Math.floor(C),L=Math.floor(A),D=Math.ceil(k-C),I=Math.ceil(O-A);l.save(),i.clearRect(l,R,L,D,I,a.background),l.beginPath(),l.rect(R,L,D,I),l.clip(),l.setTransform(i.vpMatrix[0],i.vpMatrix[1],i.vpMatrix[4],i.vpMatrix[5],i.vpMatrix[12],i.vpMatrix[13]),a.renderer.getConfig().enableDirtyRectangleRenderingDebug&&f.dispatchEvent(new e.CustomEvent(e.CanvasEvent.DIRTY_RECTANGLE,{dirtyRect:{x:R,y:L,width:D,height:I}})),i.searchDirtyObjects(v).sort((function(t,e){return t.sortable.renderOrder-e.sortable.renderOrder})).forEach((function(t){t&&t.isVisible()&&!t.isCulled()&&i.renderDisplayObject(t,l,i.context,i.restoreStack,r)})),l.restore(),i.renderQueue.forEach((function(t){i.saveDirtyAABB(t)})),i.renderQueue=[]}i.restoreStack.forEach((function(){l.restore()})),i.restoreStack=[]})),l.hooks.render.tap(t.tag,(function(t){i.clearFullScreen||i.renderQueue.push(t)}))},t.prototype.clearRect=function(t,e,n,r,i,a){t.clearRect(e,n,r,i),a&&(t.fillStyle=a,t.fillRect(e,n,r,i))},t.prototype.renderDisplayObject=function(t,n,r,i,a){var o=t.nodeName,s=i[i.length-1];!s||t.compareDocumentPosition(s)&e.Node.DOCUMENT_POSITION_CONTAINS||(n.restore(),i.pop());var c=this.context.styleRendererFactory[o],l=this.pathGeneratorFactory[o],h=t.parsedStyle.clipPath;if(h){this.applyWorldTransform(n,h);var u=this.pathGeneratorFactory[h.nodeName];u&&(n.save(),i.push(t),n.beginPath(),u(n,h.parsedStyle),n.closePath(),n.clip())}c&&(this.applyWorldTransform(n,t),n.save(),this.applyAttributesToContext(n,t)),l&&(n.beginPath(),l(n,t.parsedStyle),t.nodeName!==e.Shape.LINE&&t.nodeName!==e.Shape.PATH&&t.nodeName!==e.Shape.POLYLINE&&n.closePath()),c&&(c.render(n,t.parsedStyle,t,r,this,a),n.restore()),t.renderable.dirty=!1},t.prototype.convertAABB2Rect=function(t){var e=t.getMin(),n=t.getMax(),r=Math.floor(e[0]),i=Math.floor(e[1]);return{x:r,y:i,width:Math.ceil(n[0])-r,height:Math.ceil(n[1])-i}},t.prototype.mergeDirtyAABBs=function(t){var n=new e.AABB;return t.forEach((function(t){var e=t.getRenderBounds();n.add(e);var r=t.renderable.dirtyRenderBounds;r&&n.add(r)})),n},t.prototype.searchDirtyObjects=function(t){var e=s(t.getMin(),2),n=e[0],r=e[1],i=s(t.getMax(),2);return this.rBush.search({minX:n,minY:r,maxX:i[0],maxY:i[1]}).map((function(t){return t.displayObject}))},t.prototype.saveDirtyAABB=function(t){var n=t.renderable;n.dirtyRenderBounds||(n.dirtyRenderBounds=new e.AABB);var r=t.getRenderBounds();r&&n.dirtyRenderBounds.update(r.center,r.halfExtents)},t.prototype.applyAttributesToContext=function(t,e){var n=e.parsedStyle,r=n.stroke,i=n.fill,a=n.opacity,o=n.lineDash,s=n.lineDashOffset;o&&t.setLineDash(o),x(s)||(t.lineDashOffset=s),x(a)||(t.globalAlpha*=a),x(r)||Array.isArray(r)||r.isNone||(t.strokeStyle=e.attributes.stroke),x(i)||Array.isArray(i)||i.isNone||(t.fillStyle=e.attributes.fill)},t.prototype.applyWorldTransform=function(t,e,n){var r=0,i=0,a=(e.parsedStyle||{}).anchor,o=a&&a[0]||0,s=a&&a[1]||0;if(0!==o||0!==s){var c=e.geometry.contentBounds;r=-o*(c&&2*c.halfExtents[0]||0),i=-s*(c&&2*c.halfExtents[1]||0)}n?(u(this.tmpMat4,e.getLocalTransform()),this.vec3a[0]=r,this.vec3a[1]=i,this.vec3a[2]=0,d(this.tmpMat4,this.tmpMat4,this.vec3a),p(this.tmpMat4,n,this.tmpMat4),p(this.tmpMat4,this.vpMatrix,this.tmpMat4)):(u(this.tmpMat4,e.getWorldTransform()),this.vec3a[0]=r,this.vec3a[1]=i,this.vec3a[2]=0,d(this.tmpMat4,this.tmpMat4,this.vec3a),p(this.tmpMat4,this.vpMatrix,this.tmpMat4)),t.setTransform(this.tmpMat4[0],this.tmpMat4[1],this.tmpMat4[4],this.tmpMat4[5],this.tmpMat4[12],this.tmpMat4[13])},t.prototype.safeMergeAABB=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];var r=new e.AABB;return t.forEach((function(t){r.add(t)})),r},t.tag="CanvasRenderer",t}(),pt=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,n,r,i,a,o){var s=n.fill,c=n.fillRule,l=n.opacity,h=n.fillOpacity,u=n.stroke,p=n.strokeOpacity,d=n.lineWidth,f=n.lineCap,v=n.lineJoin,g=n.shadowType,y=n.shadowColor,m=n.shadowBlur,M=n.filter,P=n.miterLimit,E=!x(s)&&!s.isNone,b=!x(u)&&!u.isNone&&d>0,T=0===s.alpha,S=!(!M||!M.length),w=!x(y)&&m>0,C=r.nodeName,A="inner"===g,k=b&&w&&(C===e.Shape.PATH||C===e.Shape.LINE||C===e.Shape.POLYLINE||T||A);E&&(t.globalAlpha=l*h,k||dt(r,t,w),this.fill(t,r,s,c,i,a,o),k||this.clearShadowAndFilter(t,S,w)),b&&(t.globalAlpha=l*p,t.lineWidth=d,x(P)||(t.miterLimit=P),x(f)||(t.lineCap=f),x(v)||(t.lineJoin=v),k&&(A&&(t.globalCompositeOperation="source-atop"),dt(r,t,!0),A&&(this.stroke(t,r,u,i,a,o),t.globalCompositeOperation="source-over",this.clearShadowAndFilter(t,S,!0))),this.stroke(t,r,u,i,a,o))},t.prototype.clearShadowAndFilter=function(t,e,n){if(n&&(t.shadowColor="transparent",t.shadowBlur=0),e){var r=t.filter;!x(r)&&r.indexOf("drop-shadow")>-1&&(t.filter=r.replace(/drop-shadow\([^)]*\)/,"").trim()||"none")}},t.prototype.fill=function(t,n,r,i,a,o,s){var c=this;Array.isArray(r)?r.forEach((function(e){t.fillStyle=c.getColor(e,n,t),i?t.fill(i):t.fill()})):(e.isPattern(r)&&(t.fillStyle=this.getPattern(r,n,t,a,o,s)),i?t.fill(i):t.fill())},t.prototype.stroke=function(t,n,r,i,a,o){var s=this;Array.isArray(r)?r.forEach((function(e){t.strokeStyle=s.getColor(e,n,t),t.stroke()})):(e.isPattern(r)&&(t.strokeStyle=this.getPattern(r,n,t,i,a,o)),t.stroke())},t.prototype.getPattern=function(t,e,n,r,i,a){var o,s;if("rect"===t.image.nodeName){var c=t.image.parsedStyle,l=c.width,h=c.height;s=r.contextService.getDPR();var u=r.config.offscreenCanvas;(o=a.offscreenCanvasCreator.getOrCreateCanvas(u)).width=l*s,o.height=h*s;var p=a.offscreenCanvasCreator.getOrCreateContext(u),d=[];t.image.forEach((function(t){i.renderDisplayObject(t,p,r,d,a)})),d.forEach((function(){p.restore()}))}return this.imagePool.getOrCreatePatternSync(t,n,o,s,(function(){e.renderable.dirty=!0,r.renderingService.dirtify()}))},t.prototype.getColor=function(t,n,r){var a;if(t.type===e.GradientType.LinearGradient||t.type===e.GradientType.RadialGradient){var o=n.getGeometryBounds(),s=o&&2*o.halfExtents[0]||1,c=o&&2*o.halfExtents[1]||1;a=this.imagePool.getOrCreateGradient(i(i({type:t.type},t.value),{width:s,height:c}),r)}return a},t}();function dt(t,e,n){var r=t.parsedStyle,i=r.filter,a=r.shadowColor,o=r.shadowBlur,s=r.shadowOffsetX,c=r.shadowOffsetY;i&&i.length&&(e.filter=t.style.filter),n&&(e.shadowColor=""+a,e.shadowBlur=o||0,e.shadowOffsetX=s||0,e.shadowOffsetY=c||0)}var ft=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,e,n){var r,i=e.img,a=e.shadowColor,o=e.shadowBlur,s=e.width,c=e.height;if(E(i)?r=this.imagePool.getImageSync(i):(s||(s=i.width),c||(c=i.height),r=i),r){dt(n,t,!x(a)&&o>0);try{t.drawImage(r,0,0,s,c)}catch(t){}}},t}(),vt=function(){function t(){}return t.prototype.render=function(t,e,n,r,i,a){var o=e.lineWidth,s=e.textAlign,c=e.textBaseline,l=e.lineJoin,h=e.miterLimit,u=e.letterSpacing,p=e.stroke,d=e.fill,f=e.fillOpacity,v=e.strokeOpacity,g=e.opacity,y=e.metrics,m=e.dx,M=e.dy,P=e.shadowColor,E=e.shadowBlur,b=y.lines,T=y.height,S=y.lineHeight,w=y.lineMetrics;t.font=y.font,t.lineWidth=o,t.textAlign="middle"===s?"center":s;var C=c;a.enableCSSParsing||"alphabetic"!==C||(C="bottom"),t.lineJoin=l,x(h)||(t.miterLimit=h);var A=0;"middle"===c?A=-T/2-S/2:"bottom"===c||"alphabetic"===c||"ideographic"===c?A=-T:"top"!==c&&"hanging"!==c||(A=-S);var k=m||0;A+=M||0,1===b.length&&("bottom"===C?(C="middle",A-=.5*T):"top"===C&&(C="middle",A+=.5*T)),t.textBaseline=C,dt(n,t,!x(P)&&E>0);for(var O=0;b.length>O;O++){var R=o/2+k;A+=S,x(p)||p.isNone||!o||this.drawLetterSpacing(t,b[O],w[O],s,R,A,u,f,v,g,!0),x(d)||this.drawLetterSpacing(t,b[O],w[O],s,R,A,u,f,v,g)}},t.prototype.drawLetterSpacing=function(t,e,n,r,i,a,o,s,c,l,h){if(void 0===h&&(h=!1),0!==o){var u=t.textAlign;t.textAlign="left";var p=i;"center"===r||"middle"===r?p=i-n.width/2:"right"!==r&&"end"!==r||(p=i-n.width);for(var d=Array.from(e),f=t.measureText(e).width,v=0,g=0;d.length>g;++g){var y=d[g];h?this.strokeText(t,y,p,a,c):this.fillText(t,y,p,a,s,l),p+=f-(v=t.measureText(e.substring(g+1)).width)+o,f=v}t.textAlign=u}else h?this.strokeText(t,e,i,a,c):this.fillText(t,e,i,a,s,l)},t.prototype.fillText=function(t,e,n,r,i,a){var o,s=!x(i)&&1!==i;s&&(o=t.globalAlpha,t.globalAlpha=i*a),t.fillText(e,n,r),s&&(t.globalAlpha=o)},t.prototype.strokeText=function(t,e,n,r,i){var a,o=!x(i)&&1!==i;o&&(a=t.globalAlpha,t.globalAlpha=i),t.strokeText(e,n,r),o&&(t.globalAlpha=a)},t}(),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(pt),yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(pt),mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(pt),xt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(pt),Mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(pt),Pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(pt),Et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(pt),bt=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="canvas-renderer",n}return r(n,t),n.prototype.init=function(){var t,n=i({dirtyObjectNumThreshold:500,dirtyObjectRatioThreshold:.8},this.options),r=this.context.imagePool,a=new pt(r),o=((t={})[e.Shape.CIRCLE]=a,t[e.Shape.ELLIPSE]=a,t[e.Shape.RECT]=a,t[e.Shape.IMAGE]=new ft(r),t[e.Shape.TEXT]=new vt,t[e.Shape.LINE]=a,t[e.Shape.POLYLINE]=a,t[e.Shape.POLYGON]=a,t[e.Shape.PATH]=a,t[e.Shape.GROUP]=void 0,t[e.Shape.HTML]=void 0,t[e.Shape.MESH]=void 0,t);this.context.defaultStyleRendererFactory=o,this.context.styleRendererFactory=o,this.addRenderingPlugin(new ut(n))},n.prototype.destroy=function(){this.removeAllRenderingPlugins(),delete this.context.defaultStyleRendererFactory,delete this.context.styleRendererFactory},n}(e.AbstractRendererPlugin),Tt=Object.freeze({__proto__:null,CircleRenderer:yt,EllipseRenderer:mt,ImageRenderer:ft,LineRenderer:xt,PathRenderer:Et,Plugin:bt,PolygonRenderer:Pt,PolylineRenderer:Mt,RectRenderer:gt,TextRenderer:vt}),St=function(){function t(t){this.dragndropPluginOptions=t}return t.prototype.apply=function(e){var n=this,r=e.renderingService,i=e.renderingContext.root.ownerDocument,s=i.defaultView,c=function(t){var e=t.target,r=e===i,c=r&&n.dragndropPluginOptions.isDocumentDraggable?i:e.closest&&e.closest("[draggable=true]");if(c){var l=!1,h=t.timeStamp,u=[t.clientX,t.clientY],p=null,d=[t.clientX,t.clientY],f=function(t){return a(n,void 0,void 0,(function(){var n,a,s,f,v,g;return o(this,(function(o){switch(o.label){case 0:if(!l){if(n=t.timeStamp-h,a=Math.sqrt(((y=[t.clientX,t.clientY])[0]-(m=u)[0])*(y[0]-m[0])+(y[1]-m[1])*(y[1]-m[1])),this.dragndropPluginOptions.dragstartTimeThreshold>=n||this.dragndropPluginOptions.dragstartDistanceThreshold>=a)return[2];t.type="dragstart",c.dispatchEvent(t),l=!0}return t.type="drag",t.dx=t.clientX-d[0],t.dy=t.clientY-d[1],c.dispatchEvent(t),d=[t.clientX,t.clientY],r?[3,2]:(s="pointer"===this.dragndropPluginOptions.overlap?[t.canvasX,t.canvasY]:e.getBounds().center,[4,i.elementsFromPoint(s[0],s[1])]);case 1:f=o.sent(),v=f[f.indexOf(e)+1],g=(null==v?void 0:v.closest("[droppable=true]"))||(this.dragndropPluginOptions.isDocumentDroppable?i:null),p!==g&&(p&&(t.type="dragleave",t.target=p,p.dispatchEvent(t)),g&&(t.type="dragenter",t.target=g,g.dispatchEvent(t)),(p=g)&&(t.type="dragover",t.target=p,p.dispatchEvent(t))),o.label=2;case 2:return[2]}var y,m}))}))};s.addEventListener("pointermove",f);var v=function(t){if(l){t.detail={preventClick:!0};var e=t.clone();p&&(e.type="drop",e.target=p,p.dispatchEvent(e)),e.type="dragend",c.dispatchEvent(e),l=!1}s.removeEventListener("pointermove",f)};e.addEventListener("pointerup",v,{once:!0}),e.addEventListener("pointerupoutside",v,{once:!0})}};r.hooks.init.tap(t.tag,(function(){s.addEventListener("pointerdown",c)})),r.hooks.destroy.tap(t.tag,(function(){s.removeEventListener("pointerdown",c)}))},t.tag="Dragndrop",t}(),wt=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="dragndrop",n}return r(e,t),e.prototype.init=function(){this.addRenderingPlugin(new St(i({overlap:"pointer",isDocumentDraggable:!1,isDocumentDroppable:!1,dragstartDistanceThreshold:0,dragstartTimeThreshold:0},this.options)))},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e.prototype.setOptions=function(t){Object.assign(this.plugins[0].dragndropPluginOptions,t)},e}(e.AbstractRendererPlugin),Ct=function(){function t(t){this.canvasConfig=t,this.imageCache={},this.gradientCache={},this.patternCache={}}return t.prototype.getImageSync=function(t,e){return this.imageCache[t]?e&&e(this.imageCache[t]):this.getOrCreateImage(t).then((function(t){e&&e(t)})),this.imageCache[t]},t.prototype.getOrCreateImage=function(t){var n=this;if(this.imageCache[t])return Promise.resolve(this.imageCache[t]);var r=this.canvasConfig.createImage;return new Promise((function(i,a){var o;r?o=r(t):e.isBrowser&&(o=new window.Image),o&&(o.onload=function(){n.imageCache[t]=o,i(o)},o.onerror=function(t){a(t)},o.crossOrigin="Anonymous",o.src=t)}))},t.prototype.getOrCreatePatternSync=function(t,n,r,i,a){var o=this.generatePatternKey(t);if(o&&this.patternCache[o])return this.patternCache[o];var s,c=t.image,l=t.repetition,u=t.transform,p=!1;E(c)?s=this.getImageSync(c,a):r?(s=r,p=!0):s=c;var d,f=s&&n.createPattern(s,l);if(f){var v=void 0;u?v=e.parsedTransformToMat4(e.parseTransform(u),new e.DisplayObject({})):((d=h())[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,v=d),p&&function(t,e,n){var r=n[0],i=n[1],a=n[2];t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(v,v,[1/i,1/i,1]),f.setTransform({a:v[0],b:v[1],c:v[4],d:v[5],e:v[12],f:v[13]})}return o&&f&&(this.patternCache[o]=f),f},t.prototype.getOrCreateGradient=function(t,n){var r=this.generateGradientKey(t),i=t.type,a=t.steps,o=t.width,s=t.height,c=t.cx,l=t.cy,h=t.size;if(this.gradientCache[r])return this.gradientCache[r];var u=null;if(i===e.GradientType.LinearGradient){var p=e.computeLinearGradient(o,s,t.angle);u=n.createLinearGradient(p.x1,p.y1,p.x2,p.y2)}else if(i===e.GradientType.RadialGradient){var d=e.computeRadialGradient(o,s,c,l,h),f=d.x,v=d.y;u=n.createRadialGradient(f,v,0,f,v,d.r)}return u&&(a.forEach((function(t){var n=t.offset;n.unit===e.UnitType.kPercentage&&(null==u||u.addColorStop(n.value/100,""+t.color))})),this.gradientCache[r]=u),this.gradientCache[r]},t.prototype.generateGradientKey=function(t){var e=t.width,n=t.height,r=t.steps,i=t.angle,a=t.cx,o=t.cy,s=t.size;return"gradient-".concat(t.type,"-").concat((null==i?void 0:""+i)||0,"-").concat((null==a?void 0:""+a)||0,"-").concat((null==o?void 0:""+o)||0,"-").concat((null==s?void 0:""+s)||0,"-").concat(e,"-").concat(n,"-").concat(r.map((function(t){var e=t.color;return"".concat(t.offset).concat(e)})).join("-"))},t.prototype.generatePatternKey=function(t){var e=t.image,n=t.repetition;return E(e)?"pattern-".concat(e,"-").concat(n):"rect"===e.nodeName?"pattern-".concat(e.entity,"-").concat(n):void 0},t}(),At=function(){function t(){}return t.prototype.apply=function(n){var r=n.renderingService,i=n.imagePool,a=n.renderingContext.root.ownerDocument.defaultView,o=function(t,e,n){var r=t.parsedStyle,i=r.width,a=r.height;i&&!a?t.setAttribute("height",n/e*i):!i&&a&&t.setAttribute("width",e/n*a)},s=function(t){var n=t.target,a=n.attributes;if(n.nodeName===e.Shape.IMAGE){var s=a.img,c=a.keepAspectRatio;E(s)&&i.getImageSync(s,(function(t){c&&o(n,t.width,t.height),n.renderable.dirty=!0,r.dirtify()}))}},c=function(t){var n=t.target,a=t.newValue;n.nodeName===e.Shape.IMAGE&&"img"===t.attrName&&E(a)&&i.getOrCreateImage(a).then((function(t){n.attributes.keepAspectRatio&&o(n,t.width,t.height),n.renderable.dirty=!0,r.dirtify()}))};r.hooks.init.tap(t.tag,(function(){a.addEventListener(e.ElementEvent.MOUNTED,s),a.addEventListener(e.ElementEvent.ATTR_MODIFIED,c)})),r.hooks.destroy.tap(t.tag,(function(){a.removeEventListener(e.ElementEvent.MOUNTED,s),a.removeEventListener(e.ElementEvent.ATTR_MODIFIED,c)}))},t.tag="LoadImage",t}(),kt=function(t){function e(){var e=t.apply(this,c([],s(arguments),!1))||this;return e.name="image-loader",e}return r(e,t),e.prototype.init=function(){this.context.imagePool=new Ct(this.context.config),this.addRenderingPlugin(new At)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(e.AbstractRendererPlugin),Ot=function(){function t(){}return t.prototype.apply=function(e){var n=e.renderingService,r=e.config,i=e.contextService.getDomElement(),a=function(t){n.hooks.pointerDown.call(t)},o=function(t){n.hooks.pointerUp.call(t)},s=function(t){n.hooks.pointerMove.call(t)},c=function(t){n.hooks.pointerOver.call(t)},l=function(t){n.hooks.pointerOut.call(t)},h=function(t){n.hooks.click.call(t)},u=function(t){n.hooks.pointerCancel.call(t)};n.hooks.init.tap(t.tag,(function(){i.addEventListener("touchstart",a,!0),i.addEventListener("touchend",o,!0),i.addEventListener("touchmove",s,!0),i.addEventListener("touchcancel",u,!0),i.addEventListener("mouseout",l,!0),i.addEventListener("mouseover",c,!0),r.useNativeClickEvent&&i.addEventListener("click",h,!0)})),n.hooks.destroy.tap(t.tag,(function(){i.removeEventListener("touchstart",a,!0),i.removeEventListener("touchend",o,!0),i.removeEventListener("touchmove",s,!0),i.removeEventListener("touchcancel",u,!0),i.removeEventListener("mouseout",l,!0),i.removeEventListener("mouseover",c,!0),r.useNativeClickEvent&&i.removeEventListener("click",h,!0)}))},t.tag="MobileInteraction",t}(),Rt=function(t){function e(){var e=t.apply(this,c([],s(arguments),!1))||this;return e.name="mobile-interaction",e}return r(e,t),e.prototype.init=function(){this.addRenderingPlugin(new Ot)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(e.AbstractRendererPlugin),Lt="object"==typeof performance&&performance.now?performance:Date,Dt=function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.abs(n)>Math.abs(r)?n>0?"right":"left":r>0?"down":"up"},It=function(t,e){var n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return Math.sqrt(n*n+r*r)},Bt=function(){function t(t){var e=this;this.options=t,this.evCache=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this._start=function(t,n){var r;e.reset(),e.startTime=Lt.now();var i=e.evCache,a=e.startPoints;if(t){var o=t.pointerId,l=t.x,h=t.y,u=i.findIndex((function(t){return o===t.pointerId}));-1!==u&&i.splice(u,1),i.push({pointerId:o,x:l,y:h,ev:t});for(var p=c([],s((null===(r=t.nativeEvent)||void 0===r?void 0:r.touches)||[]),!1),d=function(t){if(p.find((function(e){return i[t].pointerId===e.identifier})))return"continue";i.splice(t,1)},f=i.length-1;f>-1;f--)d(f)}a.length=i.length;for(f=0;i.length>f;f++){var v=i[f];a[f]={x:l=v.x,y:h=v.y}}if(1!==a.length){var g,y;e.startDistance=It(a[0],a[1]),e.center={x:(g=a[0]).x+((y=a[1]).x-g.x)/2,y:g.y+(y.y-g.y)/2}}else{var m=i[0].ev;e.pressTimeout=setTimeout((function(){var t="press",r="none";m.direction=r,m.deltaX=0,m.deltaY=0,m.points=a,e.emitStart(t,m,n),m.type=t,n.dispatchEvent(m),e.eventType=t,e.direction=r,e.movingTarget=n}),250)}},this._move=function(t,n){e.clearPressTimeout();var r=e.startPoints,i=e.evCache;if(r.length){for(var a=t.x,o=t.y,s=t.pointerId,c=0,l=i.length;l>c;c++)if(s===i[c].pointerId){i[c]={pointerId:s,x:a,y:o,ev:t};break}var h={x:a,y:o},u=i.map((function(t){return{x:t.x,y:t.y}})),p=Lt.now();if(e.prevMoveTime=e.lastMoveTime,e.prevMovePoint=e.lastMovePoint,e.lastMoveTime=p,e.lastMovePoint=h,1===r.length){var d=r[0],f=a-d.x,v=o-d.y,g=e.direction||Dt(d,h);e.direction=g;var y=e.getEventType(h,n,t);return t.direction=g,t.deltaX=f,t.deltaY=v,t.points=u,e.emitStart(y,t,n),t.type=y,void e.refreshAndGetTarget(n).dispatchEvent(t)}var m=e.startDistance,x=It(u[0],u[1]);t.zoom=x/m,t.center=e.center,t.points=u,e.emitStart("pinch",t,n),e._throttleEmit("pinch",t,n)}},this._end=function(t,n){var r=e.evCache,i=e.startPoints,a=r.map((function(t){return{x:t.x,y:t.y}}));if(t.points=a,e.emitEnd(t,e.refreshAndGetTarget(n)),1===r.length){var o=Lt.now(),s=e.lastMoveTime;if(100>o-s){var c=s-(e.prevMoveTime||e.startTime);if(c>0){var l=e.prevMovePoint||i[0],h=e.lastMovePoint||i[0],u=It(l,h)/c;u>.3&&(t.velocity=u,t.direction=Dt(l,h),t.type="swipe",n.dispatchEvent(t))}}}for(var p=0,d=r.length;d>p;p++)if(r[p].pointerId===t.pointerId){r.splice(p,1),i.splice(p,1);break}e.reset(),r.length>0&&e._start(void 0,n)},this._cancel=function(t,n){var r=e.evCache.map((function(t){return{x:t.x,y:t.y}}));t.points=r,e.emitEnd(t,e.refreshAndGetTarget(n)),e.evCache=[],e.reset()}}return t.prototype.apply=function(e){var n=this,r=e.renderingService,i=e.renderingContext.root.ownerDocument,a=i.defaultView;this.canvas=a;var o=function(t){return t===i&&n.options.isDocumentGestureEnabled?i:t},s=function(t){var e=o(t.target);e&&n._move(t,e)},c=function(t){var e=o(t.target);e&&n._start(t,e)},l=function(t){var e=o(t.target);e&&n._end(t,e)},h=function(t){var e=o(t.target);e&&n._cancel(t,e)},u=function(t){var e=o(t.target);e&&n._end(t,e)};r.hooks.init.tap(t.tag,(function(){a.addEventListener("pointermove",s),a.addEventListener("pointerdown",c),a.addEventListener("pointerup",l),a.addEventListener("pointercancel",h),a.addEventListener("pointerupoutside",u)})),r.hooks.destroy.tap(t.tag,(function(){a.removeEventListener("pointermove",s),a.removeEventListener("pointerdown",c),a.removeEventListener("pointerup",l),a.removeEventListener("pointercancel",h),a.removeEventListener("pointerupoutside",u)}))},t.prototype.getEventType=function(t,e,n){var r,i=this,a=i.eventType,o=i.startTime,s=i.startPoints;if(a)return a;(this.movingTarget=e,this.isPanListenerInPath=n.path.some((function(t){var e,n;return!!(null===(n=null===(e=t.emitter)||void 0===e?void 0:e.eventNames())||void 0===n?void 0:n.includes("pan"))})),this.isPanListenerInPath)?r=Lt.now()-o>250&&10>It(s[0],t)?"press":"pan":r="press";return this.eventType=r,r},t.prototype.enable=function(t){this.processEvent[t]=!0},t.prototype.isProcess=function(t){return this.processEvent[t]},t.prototype.emitStart=function(t,e,n){this.isProcess(t)||(this.enable(t),e.type="".concat(t,"start"),n.dispatchEvent(e))},t.prototype._throttleEmit=function(t,e,n){var r=this;this.pushEvent(t,e);var i=this,a=i.emitThrottles,o=i.processEvent;i.throttleTimer||(this.throttleTimer=this.canvas.requestAnimationFrame((function(){for(var t=0,e=a.length;e>t;t++){var i=a[t],s=i.type,c=i.ev;o[s]&&(c.type=s,n.dispatchEvent(c))}r.throttleTimer=0,r.emitThrottles.length=0})))},t.prototype.emitEnd=function(t,e){var n=this.processEvent;Object.keys(n).forEach((function(r){t.type="".concat(r,"end"),e.dispatchEvent(t),delete n[r]}))},t.prototype.pushEvent=function(t,e){for(var n=this.emitThrottles,r={type:t,ev:e},i=0,a=n.length;a>i;i++)if(n[i].type===t)return void n.splice(i,1,r);n.push(r)},t.prototype.clearPressTimeout=function(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)},t.prototype.refreshAndGetTarget=function(t){return this.movingTarget?(this.movingTarget&&!this.movingTarget.isConnected&&(this.movingTarget=t),this.movingTarget):t},t.prototype.reset=function(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null,this.movingTarget=null,this.isPanListenerInPath=null},t.tag="Gesture",t}(),Nt=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="gesture",n}return r(e,t),e.prototype.init=function(){this.addRenderingPlugin(new Bt(i({isDocumentGestureEnabled:!1},this.options)))},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(e.AbstractRendererPlugin);var Ft=function(){function t(t){this.canvasConfig=t.config}return t.prototype.init=function(){return a(this,void 0,void 0,(function(){var t,e,n;return o(this,(function(r){return e=(t=this.canvasConfig).devicePixelRatio,this.$canvas=t.canvas,this.context=this.$canvas.getContext("2d"),this.dpr=n=1>(n=e||1)?1:Math.ceil(n),this.resize(this.canvasConfig.width,this.canvasConfig.height),[2]}))}))},t.prototype.getContext=function(){return this.context},t.prototype.getDomElement=function(){return this.$canvas},t.prototype.getDPR=function(){return this.dpr},t.prototype.getBoundingClientRect=function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()},t.prototype.destroy=function(){this.context=null,this.$canvas=null},t.prototype.resize=function(t,e){var n,r=this.canvasConfig.devicePixelRatio,i=this.$canvas;i.style&&(i.style.width=t+"px",i.style.height=e+"px"),(n=i)&&"object"==typeof n&&(1===n.nodeType&&n.nodeName||n.isCanvasElement)&&(i.width=t*r,i.height=e*r,1!==r&&this.context.scale(r,r))},t.prototype.applyCursorStyle=function(t){},t.prototype.toDataURL=function(t){return a(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.context.canvas.toDataURL(t.type,t.encoderOptions)]}))}))},t}(),Gt=function(t){function e(){var e=t.apply(this,c([],s(arguments),!1))||this;return e.name="mobile-canvas-context-register",e}return r(e,t),e.prototype.init=function(){this.context.ContextService=Ft},e.prototype.destroy=function(){delete this.context.ContextService},e}(e.AbstractRendererPlugin),jt=function(t){function e(e){var n=t.call(this,e)||this;return n.registerPlugin(new Gt),n.registerPlugin(new kt),n.registerPlugin(new R),n.registerPlugin(new bt),n.registerPlugin(new Rt),n.registerPlugin(new lt),n.registerPlugin(new wt({isDocumentDraggable:!!x(null==e?void 0:e.isDocumentDraggable)||e.isDocumentDraggable,isDocumentDroppable:!!x(null==e?void 0:e.isDocumentDroppable)||e.isDocumentDroppable,dragstartDistanceThreshold:x(null==e?void 0:e.dragstartDistanceThreshold)?10:e.dragstartDistanceThreshold,dragstartTimeThreshold:x(null==e?void 0:e.dragstartTimeThreshold)?50:e.dragstartTimeThreshold})),n.registerPlugin(new Nt({isDocumentGestureEnabled:!0})),n}return r(e,t),e}(e.AbstractRenderer);t.CanvasPicker=ht,t.CanvasRenderer=Tt,t.Renderer=jt}));
//# sourceMappingURL=index.umd.min.js.map
